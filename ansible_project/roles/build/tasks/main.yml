- name: Ensure target directory is removed to avoid permission issues
  file:
    path: /home/dhayanidhi-s/ci_cd_workspace/target
    state: absent

- name: Build the Java project using Maven
  command: mvn clean package
  args:
    chdir: /home/dhayanidhi-s/ci_cd_workspace
  register: build_result
  ignore_errors: yes

- name: Create rollback trigger file if build failed
  file:
    path: /tmp/build_failed
    state: touch
  when: build_result.rc != 0
